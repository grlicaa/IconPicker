/* global fa */
var fontapex=fontapex||{};function setElementIcon(e,t){$("input#"+e+".apex-item-has-icon").parent("div").find("span.apex-item-icon").attr("class","apex-item-icon fa "+t)}function setElementValue(e,t){$("input#"+e).val(t),setElementIcon(e,t)}function setIGElementValue(e,t,n,i){const o=apex.region(e).widget(),a=o.interactiveGrid("getViews","grid").model,c=o.interactiveGrid("getViews").grid.model.getOption("fields");let s="";for(var r in c)c[r].elementId===n&&(s=r);a.setRecordValue(t,s,i)}function closeDialogIP(e,t,n,i,o,a){e?($("#IconPickerDialogBox").dialog("close"),setIGElementValue(n,i,o,a)):(setElementValue(t,a),$("#IconPickerDialogBox").dialog("close"))}function addItemList(e){$(e).each(function(){try{$(this).iconList({multiple:!1,navigation:!0,itemSelector:!1})}catch(e){console.log(e.message)}})}function loadIconPickerDialog(e,t){$("body").append('<div id="IconPickerDialogBox"></div>'),$("#IconPickerDialogBox").dialog({modal:!0,title:"Icon Picker",autoOpen:!1,resizable:!0,width:600,height:800,closeOnEscape:!0,tirggElem:"",tirggItem:{},showIconLabel:!0,modalItem:!1,useIconList:t,open:function(){window.addEventListener("keydown",function(e){[37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),initIcons(fontapex,$(this).dialog("option","tirggElem"),$(this).dialog("option","tirggItem"),{is_grid:$(this).dialog("option","modalItem"),showIconLabel:$(this).dialog("option","showIconLabel"),useIconList:$(this).dialog("option","useIconList")})},close:function(){$("main.dm-Body").remove()},cancel:function(){$("main.dm-Body").remove()},buttons:[{text:e,click:function(){$(this).dialog("close")}}]})}function initIcons(e,t,n,i){var o,a,c,s,r,l=e.$,d="LARGE",u="SMALL",f=n||{regionId:"",rowId:"",column:""},h="force-fa-lg",m=window.location.hash.replace("#","")||"fa-apex",g=[],p=l("#icons"),v=function(e){if(e)try{localStorage.setItem("large.fontapex",e)}catch(t){o=e}else try{return localStorage.getItem("large.fontapex")||"false"}catch(e){return o||(o="false")}},I=function(e){var n;clearTimeout(a);var o=e.debounce||50,r=e.filterString||"",l=r.length;r=r.toUpperCase().trim();var d=function(e,o){v();var a=function(e){return'<li role="navigation"><a class="dm-Search-result" href="javascript:closeDialogIP('+i.is_grid+",'"+t+"','"+f.regionId+"','"+f.rowId+"','"+f.column+"','"+e+'\');" aria-labelledby="iplist"><div class="dm-Search-icon"><span class="t-Icon fa '+e+'" aria-hidden="true"></span></div>'+(i.showIconLabel?'<div class="dm-Search-info"><span class="dm-Search-class">'+e+"</span></div>":"")+"</a></li>"};o?(n=(n+='<div class="dm-Search-category">')+'<h2 class="dm-Search-title">'+o.replace(/_/g," ").toLowerCase()+" Icons</h2>",n+='<ul class="dm-Search-list" id="iplist">',e.forEach(function(e){n+=a(e.name)}),n+="</ul>",n+="</div>"):e.length>0&&e.forEach(function(e){n+=a(e.name)})};a=setTimeout(function(){!function(){if(1!==r.length){var e=[],t="";n="",""===r?s.forEach(function(t){e=c[t].sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),d(e,t)}):((e=g.filter(function(e){var t,n,i,o,a,c,s=e.name.toUpperCase().slice(3),d=e.filters?e.filters.toUpperCase():"",u=0;if(r.indexOf(" ")>0&&(r=r.replace(" ","-")),s.indexOf(r)>=0){for(c=(t=s.split("-")).length,s.indexOf("-")<0&&(u+=1e3),s.length===l&&(u+=1e3),t[0].slice(0,l).indexOf(r)>=0&&(u+=1e3),a=0;a<c;a++)t[a]&&t[a].indexOf(r)>=0&&(u+=100);return e.rank=u,!0}for(o=(n=d.split(",")).length,i=0;i<o;i++)if(n[i].slice(0,l).indexOf(r)>=0)return e.rank=1,!0})).sort(function(e,t){var n=e.rank,i=t.rank;return n>i?-1:n<i?1:0}),d(e),t=0===e.length?"No results":e.length+" Results",n='<div class="dm-Search-category"><h2 class="dm-Search-title">'+t+'</h2><ul class="dm-Search-list" id="iplist">'+n+"</ul>",n+="</div>"),document.getElementById("icons").innerHTML=n}}(),i.useIconList&&addItemList("ul#iplist")},o)};l("#icon_preview").length>0?("true"===v()?(document.getElementById("icon_size_large").checked=!0,p.addClass(h)):(document.getElementById("icon_size_small").checked=!0,p.removeClass(h)),m&&(l(".dm-Icon-name").text(m),l("[data-icon]").removeClass("fa-apex").addClass(m),renderIconPreview(),l("button.pv-Button").on("click",function(){var e="true"===v()?d.toLowerCase():u.toLowerCase();window.open("../svgs/"+e+"/"+m.replace("fa-","")+".svg")})),l("input, select").on("change",function(){renderIconPreview()})):("true"===v()?(document.getElementById("icon_size_large").checked=!0,p.addClass(h)):(document.getElementById("icon_size_small").checked=!0,p.removeClass(h)),e.icons&&(I({}),r=[],c=e.icons,(s=Object.keys(c)).forEach(function(e){r=r.concat(c[e])}),g=r,l("#search").on("keyup",function(e){I({debounce:250,filterString:e.target.value})}),l('[name="icon_size"]').on("click",function(e){var t,n,i=p.length>0?p:l(".dm-IconPreview");n=i,(t=this).checked=!0,t.value===d?(n.addClass(h),v("true")):(n.removeClass(h),v("false"))})))}NodeList.prototype.forEach||(NodeList.prototype.forEach=Array.prototype.forEach),fontapex.$=function(e){var t=function(e){var t=[];return"string"==typeof e?t=document.querySelectorAll(e):t.push(e),this.elements=t,this.length=this.elements.length,this};return t.prototype={addClass:function(e){var t=e.replace(/ +(?= )/g,"").split(" ");return this.elements.forEach(function(e){t.forEach(function(t){t&&e.classList.add(t)})}),this},removeClass:function(e){var t=e?function(t){t.classList.remove(e)}:function(e){e.className=""};return this.elements.forEach(function(e){t(e)}),this},getClass:function(){return this.elements[0].classList.value},on:function(e,t){return this.elements.forEach(function(n){n.addEventListener(e,t)}),this},val:function(){var e="";return this.elements.forEach(function(t){switch(t.nodeName){case"INPUT":t.checked&&(e=t.value);break;case"SELECT":e=t.options[t.selectedIndex].value}}),e},text:function(e){return e&&this.elements.forEach(function(t){t.textContent=e}),this},html:function(e){var t;return"string"==typeof e?(this.elements.forEach(function(t){t.innerHTML=e}),this):(this.elements.forEach(function(e){t=e.innerHTML}),t)},parent:function(){var e;return this.elements.forEach(function(n){e=new t(n.parentNode)}),e},hide:function(){return this.elements.forEach(function(e){e.style.display="none"}),this},show:function(e){return this.elements.forEach(function(e){e.style.display=null}),this}},new t(e)};